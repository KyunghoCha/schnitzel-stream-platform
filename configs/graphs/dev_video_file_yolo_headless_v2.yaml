version: 2

nodes:
  - id: src
    kind: source
    plugin: schnitzel_stream.packs.vision.nodes:OpenCvVideoFileSource
    config:
      path: ${oc.env:SS_INPUT_PATH,data/samples/2048246-hd_1920_1080_24fps.mp4}
      source_id: ${oc.env:SS_STREAM_ID,file01}
      max_frames: ${oc.env:SS_MAX_FRAMES,0}
      loop: ${oc.env:SS_INPUT_LOOP,false}

  - id: yolo
    kind: node
    plugin: schnitzel_stream.packs.vision.nodes:YoloV8DetectorNode
    config:
      __runtime__:
        # Intent: keep only the freshest frame when inference lags input.
        inbox_max: 1
        inbox_overflow: drop_oldest
      model_path: ${oc.env:SS_YOLO_MODEL_PATH,models/yolov8n.pt}
      conf: ${oc.env:SS_YOLO_CONF,0.35}
      iou: ${oc.env:SS_YOLO_IOU,0.45}
      max_det: ${oc.env:SS_YOLO_MAX_DET,100}
      device: ${oc.env:SS_YOLO_DEVICE,cpu}

edges:
  - from: src
    to: yolo

config: {}
