Arduino Mega + Ultrasonic + AduCam run commands (latest)

0) Arduino IDE
- Upload ultrasonic sketch to Arduino Mega.
- Serial Monitor baud = 115200, confirm line output.
- IMPORTANT: close Serial Monitor before pipeline run.

1) Terminal 1 (setup, project root)
cd ~/Projects/schnitzel-stream-platform
python -m pip install pyserial
python -m pip install -r requirements-model.txt
python -m pip install "numpy<2"
ls /dev/ttyACM* /dev/ttyUSB* 2>/dev/null || true
# ttyUSB* 가 없어도 정상일 수 있음(Arduino Mega는 보통 /dev/ttyACM0).

2) Terminal 1 (GPU check)
nvidia-smi
python - <<'PY'
import torch
print("torch:", torch.__version__)
print("cuda_available:", torch.cuda.is_available())
print("device_count:", torch.cuda.device_count())
print("device0:", torch.cuda.get_device_name(0) if torch.cuda.is_available() else "cpu")
PY

3) Terminal 1 (run pipeline: AduCam + Arduino ultrasonic + YOLO real on GPU)
cd ~/Projects/schnitzel-stream-platform

export AI_MODEL_MODE=real
export AI_MODEL_ADAPTER=ai.vision.adapters.yolo_adapter:YOLOAdapter
export YOLO_MODEL_PATH=models/yolov8n.pt
export YOLO_DEVICE=0

export AI_SENSOR_ENABLED=true
export AI_SENSOR_TYPE=ultrasonic
export AI_SENSOR_ADAPTER=ai.plugins.sensors.serial_ultrasonic:SerialUltrasonicSensorSource
export AI_SERIAL_PORT=/dev/ttyACM0
export AI_SERIAL_BAUDRATE=115200
export AI_SERIAL_READ_TIMEOUT_SEC=0.2
export AI_SERIAL_SENSOR_ID=ultrasonic-front-01
export AI_SENSOR_TIME_WINDOW_MS=5000

PYTHONPATH=src python -m schnitzel_stream \
  --source-type webcam \
  --camera-index 0 \
  --visualize \
  --output-jsonl outputs/live_webcam_sensor.jsonl

4) Terminal 2 (verify sensor fields in emitted events)
cd ~/Projects/schnitzel-stream-platform
tail -f outputs/live_webcam_sensor.jsonl | rg --line-buffered "distance_cm|sensor_id|sensor_type|event_type"

5) If port/camera index differ
# serial port example
export AI_SERIAL_PORT=/dev/ttyUSB0

# webcam index example
PYTHONPATH=src python -m schnitzel_stream --source-type webcam --camera-index 1 --visualize --output-jsonl outputs/live_webcam_sensor.jsonl

6) If serial open fails (Device or resource busy)
# who is holding the port
lsof /dev/ttyACM0

# close Arduino IDE/Serial Monitor; if java still holds the port:
pkill -f arduino-ide || true
pkill -f "java.*arduino" || true

# re-check and run again
lsof /dev/ttyACM0 || true

7) If you only want quick hardware pipeline check (mock model)
cd ~/Projects/schnitzel-stream-platform
export AI_MODEL_MODE=mock
PYTHONPATH=src python -m schnitzel_stream --source-type webcam --camera-index 0 --visualize --output-jsonl outputs/live_webcam_sensor.jsonl
